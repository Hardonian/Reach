{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://reach.dev/protocol/schemas/events.schema.json",
  "title": "RunEvent",
  "oneOf": [
    {
      "type": "object",
      "properties": { "type": { "const": "run_created" } },
      "required": ["type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": { "type": { "const": "run_started" } },
      "required": ["type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "tool_call_requested" },
        "step_id": { "type": "string" },
        "call": { "$ref": "toolcall.schema.json#/$defs/ToolCall" }
      },
      "required": ["type", "step_id", "call"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "tool_call_completed" },
        "step_id": { "type": "string" },
        "result": { "$ref": "toolcall.schema.json#/$defs/ToolResult" }
      },
      "required": ["type", "step_id", "result"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "policy_denied" },
        "step_id": { "type": "string" },
        "call": { "$ref": "toolcall.schema.json#/$defs/ToolCall" },
        "reason": { "type": "string" }
      },
      "required": ["type", "step_id", "call", "reason"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "artifact_emitted" },
        "step_id": { "type": "string" },
        "patch": { "$ref": "artifact.schema.json#/$defs/Patch" }
      },
      "required": ["type", "step_id", "patch"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": { "type": { "const": "run_completed" } },
      "required": ["type"],
      "additionalProperties": false
    },
    {
      "type": "object",
      "properties": {
        "type": { "const": "run_failed" },
        "reason": { "type": "string" }
      },
      "required": ["type", "reason"],
      "additionalProperties": false
    }
  ]
}
