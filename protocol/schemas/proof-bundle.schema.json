{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://reach.sh/schemas/proof-bundle.json",
  "title": "Proof Bundle Schema",
  "description": "Schema for standalone proof bundles in the Reach system (.reach-proof.json)",
  "type": "object",
  "required": ["version", "fingerprint", "merkleRoot", "inputArtifactDigests", "outputDigest", "policyDigest", "transcriptDigest", "engineVersion", "protocolVersion", "createdAt"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Proof bundle format version"
    },
    "fingerprint": {
      "type": "string",
      "description": "SHA-256 hash of the entire proof bundle (excluding signature)"
    },
    "merkleRoot": {
      "type": "string",
      "description": "Merkle root of the execution transcript"
    },
    "inputArtifactDigests": {
      "type": "array",
      "description": "SHA-256 digests of input artifacts used in execution",
      "items": {
        "type": "object",
        "required": ["name", "digest"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Artifact name"
          },
          "digest": {
            "type": "string",
            "description": "SHA-256 digest of the artifact"
          },
          "version": {
            "type": "string",
            "description": "Artifact version if applicable"
          }
        }
      }
    },
    "outputDigest": {
      "type": "string",
      "description": "SHA-256 digest of the execution output"
    },
    "policyDigest": {
      "type": "string",
      "description": "SHA-256 digest of the policy used for execution"
    },
    "transcriptDigest": {
      "type": "string",
      "description": "SHA-256 digest of the full execution transcript"
    },
    "engineVersion": {
      "type": "string",
      "description": "Version of the Reach engine"
    },
    "protocolVersion": {
      "type": "string",
      "description": "Version of the Reach protocol"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when bundle was created"
    },
    "runId": {
      "type": "string",
      "description": "Optional run ID this proof belongs to"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the proof",
      "properties": {
        "packName": {
          "type": "string",
          "description": "Name of the pack that was executed"
        },
        "packVersion": {
          "type": "string",
          "description": "Version of the pack"
        },
        "environment": {
          "type": "object",
          "description": "Environment variables used (hashed)",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    },
    "signature": {
      "type": "object",
      "description": "Digital signature of the proof bundle",
      "properties": {
        "keyId": {
          "type": "string",
          "description": "Key identifier used for signing"
        },
        "algorithm": {
          "type": "string",
          "enum": ["ed25519", "rsa-sha256"],
          "description": "Signature algorithm"
        },
        "signature": {
          "type": "string",
          "description": "Base64-encoded signature"
        }
      }
    },
    "verificationStatus": {
      "type": "string",
      "enum": ["UNVERIFIED", "VERIFIED", "INVALID", "EXPIRED"],
      "description": "Verification status of the proof bundle"
    },
    "verifiedAt": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last verification"
    }
  }
}
