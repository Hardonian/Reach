{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://reach.dev/schemas/orchestration-plan.schema.json",
  "title": "Reach Orchestration Plan",
  "description": "Deterministic orchestration plan generated by the Planner",
  "type": "object",
  "required": [
    "orchestration_plan",
    "spawn_tree",
    "capability_plan",
    "node_routing",
    "policy_trace",
    "budget",
    "observability",
    "failure_model"
  ],
  "properties": {
    "orchestration_plan": {
      "type": "object",
      "required": ["phases", "description", "estimated_complexity", "requires_install"],
      "properties": {
        "phases": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "description": { "type": "string" },
              "steps": { "type": "array" },
              "dependencies": { "type": "array", "items": { "type": "string" } }
            }
          }
        },
        "description": { "type": "string" },
        "estimated_complexity": { "type": "string" },
        "requires_install": { "type": "boolean" }
      }
    },
    "spawn_tree": {
      "type": "array",
      "items": { "$ref": "#/definitions/spawnNode" }
    },
    "capability_plan": {
      "type": "object",
      "required": ["required_capabilities", "side_effect_types", "tier_required", "risk_level"],
      "properties": {
        "required_capabilities": {
          "type": "array",
          "items": { "type": "string" }
        },
        "side_effect_types": { "type": "array", "items": { "type": "string" } },
        "tier_required": { "type": "string" },
        "risk_level": { "type": "string" }
      }
    },
    "node_routing": {
      "type": "object",
      "required": ["strategy", "agent_assignments"],
      "properties": {
        "strategy": { "type": "string" },
        "agent_assignments": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "agent_id": { "type": "string" },
              "node_id": { "type": "string" }
            }
          }
        }
      }
    },
    "policy_trace": {
      "type": "array",
      "items": { "type": "object" }
    },
    "budget": {
      "type": "object",
      "required": [
        "max_spawn_depth",
        "max_children_per_node",
        "estimated_tool_calls",
        "retry_limit"
      ],
      "properties": {
        "max_spawn_depth": { "type": "integer" },
        "max_children_per_node": { "type": "integer" },
        "estimated_tool_calls": { "type": "integer" },
        "retry_limit": { "type": "integer" }
      }
    },
    "timeouts": {
      "type": "object",
      "additionalProperties": { "type": "integer" }
    },
    "observability": {
      "type": "object",
      "required": ["events_emitted", "metrics_tracked"],
      "properties": {
        "events_emitted": { "type": "array", "items": { "type": "string" } },
        "metrics_tracked": { "type": "array", "items": { "type": "string" } }
      }
    },
    "failure_model": {
      "type": "object",
      "required": ["possible_failures", "fallback_strategy"],
      "properties": {
        "possible_failures": { "type": "array", "items": { "type": "string" } },
        "fallback_strategy": { "type": "string" }
      }
    }
  },
  "definitions": {
    "spawnNode": {
      "type": "object",
      "required": ["id", "agent_type"],
      "properties": {
        "id": { "type": "string" },
        "parent_id": { "type": "string" },
        "agent_type": { "type": "string" },
        "children": {
          "type": "array",
          "items": { "$ref": "#/definitions/spawnNode" }
        }
      }
    }
  }
}
