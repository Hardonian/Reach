<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reach Replay Diff</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        min-height: 100vh;
        padding: 2rem;
      }
      .header {
        margin-bottom: 2rem;
      }
      h1 {
        font-size: 1.5rem;
        color: #60a5fa;
        margin-bottom: 0.5rem;
      }
      .subtitle {
        color: #64748b;
        font-size: 0.875rem;
      }
      .comparison-header {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
        align-items: center;
      }
      .run-info {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.5rem;
        padding: 1rem;
      }
      .run-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: #64748b;
        letter-spacing: 0.05em;
        margin-bottom: 0.25rem;
      }
      .run-id {
        font-family: monospace;
        font-size: 0.875rem;
        color: #94a3b8;
      }
      .run-time {
        font-size: 0.75rem;
        color: #64748b;
        margin-top: 0.25rem;
      }
      .vs-badge {
        background: #334155;
        color: #94a3b8;
        padding: 0.5rem 1rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        font-weight: 600;
      }
      .status-match {
        color: #22c55e;
      }
      .status-drift {
        color: #f59e0b;
      }
      .status-error {
        color: #ef4444;
      }
      .diff-container {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      .diff-section {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.5rem;
        overflow: hidden;
      }
      .diff-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 1rem;
        background: #252f47;
        border-bottom: 1px solid #334155;
      }
      .diff-title {
        font-weight: 600;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .diff-status {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 0.25rem;
        text-transform: uppercase;
        font-weight: 600;
      }
      .diff-status.match {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
      }
      .diff-status.drift {
        background: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
      }
      .diff-content {
        padding: 1rem;
        font-family: "Monaco", "Consolas", monospace;
        font-size: 0.875rem;
        line-height: 1.6;
      }
      .diff-line {
        display: flex;
        gap: 1rem;
      }
      .diff-line-num {
        color: #64748b;
        min-width: 2rem;
        text-align: right;
        user-select: none;
      }
      .diff-line-content {
        flex: 1;
        white-space: pre-wrap;
        word-break: break-all;
      }
      .diff-line.added {
        background: rgba(34, 197, 94, 0.1);
      }
      .diff-line.added .diff-line-content {
        color: #22c55e;
      }
      .diff-line.removed {
        background: rgba(239, 68, 68, 0.1);
      }
      .diff-line.removed .diff-line-content {
        color: #ef4444;
      }
      .diff-line.added::before {
        content: "+";
        color: #22c55e;
        margin-right: 0.5rem;
      }
      .diff-line.removed::before {
        content: "-";
        color: #ef4444;
        margin-right: 0.5rem;
      }
      .summary-bar {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }
      .summary-item {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 0.5rem;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .summary-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
      }
      .summary-icon.match {
        background: rgba(34, 197, 94, 0.2);
      }
      .summary-icon.drift {
        background: rgba(245, 158, 11, 0.2);
      }
      .summary-icon.error {
        background: rgba(239, 68, 68, 0.2);
      }
      .summary-text {
        display: flex;
        flex-direction: column;
      }
      .summary-value {
        font-weight: 700;
        font-size: 1.125rem;
      }
      .summary-label {
        font-size: 0.75rem;
        color: #64748b;
      }
      .controls {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
      }
      .btn {
        padding: 0.5rem 1rem;
        background: #334155;
        border: none;
        border-radius: 0.375rem;
        color: #e2e8f0;
        cursor: pointer;
        font-size: 0.875rem;
        transition: background 0.2s;
      }
      .btn:hover {
        background: #475569;
      }
      .btn.active {
        background: #3b82f6;
      }
      .fingerprint-comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #334155;
      }
      .fingerprint-box {
        font-family: monospace;
        font-size: 0.75rem;
        padding: 0.5rem;
        background: #0f172a;
        border-radius: 0.25rem;
        word-break: break-all;
      }
      .fingerprint-label {
        font-size: 0.625rem;
        color: #64748b;
        text-transform: uppercase;
        margin-bottom: 0.25rem;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>ðŸ”„ Replay Diff</h1>
      <p class="subtitle">Compare original execution with replay to verify determinism</p>
    </div>

    <div class="comparison-header">
      <div class="run-info">
        <div class="run-label">Original Run</div>
        <div class="run-id">run_abc123def456</div>
        <div class="run-time">2024-01-15 10:30:00.000Z</div>
      </div>
      <div class="vs-badge">VS</div>
      <div class="run-info">
        <div class="run-label">Replay Run</div>
        <div class="run-id">run_xyz789uvw012</div>
        <div class="run-time">2024-01-15 14:45:22.156Z</div>
      </div>
    </div>

    <div class="summary-bar">
      <div class="summary-item">
        <div class="summary-icon match">âœ“</div>
        <div class="summary-text">
          <span class="summary-value">12</span>
          <span class="summary-label">Matching</span>
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-icon drift">~</div>
        <div class="summary-text">
          <span class="summary-value">2</span>
          <span class="summary-label">Drift</span>
        </div>
      </div>
      <div class="summary-item">
        <div class="summary-icon error">âœ•</div>
        <div class="summary-text">
          <span class="summary-value">0</span>
          <span class="summary-label">Errors</span>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn active" onclick="showAll()">All</button>
      <button class="btn" onclick="showOnly('drift')">Drift Only</button>
      <button class="btn" onclick="showOnly('match')">Matches Only</button>
    </div>

    <div class="diff-container" id="diffs">
      <!-- Diff sections rendered here -->
    </div>

    <script>
      const diffData = [
        {
          section: "Execution Graph",
          status: "match",
          original: JSON.stringify({ steps: 7, dependencies: 6 }, null, 2),
          replay: JSON.stringify({ steps: 7, dependencies: 6 }, null, 2),
          fingerprint: {
            original: "sha256:a3f7b2d8...",
            replay: "sha256:a3f7b2d8...",
          },
        },
        {
          section: "Step Outputs",
          status: "drift",
          original: JSON.stringify(
            {
              "step-1": { output: "Starting execution", duration: 245 },
              "step-2": { output: "Processing complete", duration: 512 },
            },
            null,
            2,
          ),
          replay: JSON.stringify(
            {
              "step-1": { output: "Starting execution", duration: 267 },
              "step-2": { output: "Processing complete", duration: 548 },
            },
            null,
            2,
          ),
          differences: ["step-1.duration: 245 â†’ 267", "step-2.duration: 512 â†’ 548"],
        },
        {
          section: "Policy Results",
          status: "match",
          original: JSON.stringify({ passed: 3, failed: 0 }, null, 2),
          replay: JSON.stringify({ passed: 3, failed: 0 }, null, 2),
        },
        {
          section: "Evidence Chain",
          status: "match",
          original: JSON.stringify({ evidence_count: 5, confidence: 0.82 }, null, 2),
          replay: JSON.stringify({ evidence_count: 5, confidence: 0.82 }, null, 2),
        },
        {
          section: "Final Output",
          status: "match",
          original: JSON.stringify({ decision: "approve", confidence: 0.82 }, null, 2),
          replay: JSON.stringify({ decision: "approve", confidence: 0.82 }, null, 2),
        },
      ];

      function renderDiffs(filter = "all") {
        const container = document.getElementById("diffs");
        container.innerHTML = "";

        const filtered = filter === "all" ? diffData : diffData.filter((d) => d.status === filter);

        for (const diff of filtered) {
          const section = document.createElement("div");
          section.className = "diff-section";
          section.dataset.status = diff.status;

          let content = "";
          if (diff.status === "match") {
            content = `<div class="diff-line"><span class="diff-line-content">${escapeHtml(diff.original)}</span></div>`;
          } else if (diff.status === "drift") {
            content = diff.differences
              .map(
                (d) =>
                  `<div class="diff-line drift"><span class="diff-line-content">${escapeHtml(d)}</span></div>`,
              )
              .join("");
          }

          let fingerprintHtml = "";
          if (diff.fingerprint) {
            fingerprintHtml = `
            <div class="fingerprint-comparison">
              <div>
                <div class="fingerprint-label">Original Fingerprint</div>
                <div class="fingerprint-box">${diff.fingerprint.original}</div>
              </div>
              <div>
                <div class="fingerprint-label">Replay Fingerprint</div>
                <div class="fingerprint-box">${diff.fingerprint.replay}</div>
              </div>
            </div>
          `;
          }

          section.innerHTML = `
          <div class="diff-header">
            <div class="diff-title">
              ${diff.status === "match" ? "âœ“" : diff.status === "drift" ? "~" : "âœ•"}
              ${diff.section}
            </div>
            <div class="diff-status ${diff.status}">${diff.status}</div>
          </div>
          <div class="diff-content">
            ${content}
            ${fingerprintHtml}
          </div>
        `;

          container.appendChild(section);
        }
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      function showAll() {
        updateButtons("all");
        renderDiffs("all");
      }

      function showOnly(status) {
        updateButtons(status);
        renderDiffs(status);
      }

      function updateButtons(active) {
        document.querySelectorAll(".btn").forEach((btn) => {
          btn.classList.remove("active");
          if (
            btn.textContent.toLowerCase().includes(active) ||
            (active === "all" && btn.textContent === "All")
          ) {
            btn.classList.add("active");
          }
        });
      }

      // Initial render
      renderDiffs();
    </script>
  </body>
</html>
