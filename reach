#!/usr/bin/env bash
set -euo pipefail

cmd="${1:-}"
case "$cmd" in
  doctor)
    shift
    (cd tools/doctor && go run . "$@")
    ;;
  release-check)
    shift
    ./tools/release-check.sh "$@"
    ;;
  serve)
    shift
    (cd services/runner && go run ./cmd/reach-serve "$@")
    ;;
  federation)
    shift
    (cd services/runner && go run ./cmd/reachctl federation "$@")
    ;;
  support)
    shift
    (cd services/runner && go run ./cmd/reachctl support "$@")
    ;;
  arcade)
    shift
    (cd services/runner && go run ./cmd/reachctl arcade "$@")
    ;;
  capsule)
    shift
    (cd services/runner && go run ./cmd/reachctl capsule "$@")
    ;;
  proof)
    shift
    (cd services/runner && go run ./cmd/reachctl proof "$@")
    ;;
  graph)
    shift
    (cd services/runner && go run ./cmd/reachctl graph "$@")
    ;;
  packs)
    shift
    (cd services/runner && go run ./cmd/reachctl packs "$@")
    ;;
  init)
    shift
    (cd services/runner && go run ./cmd/reachctl init "$@")
    ;;
  explain)
    shift
    (cd services/runner && go run ./cmd/reachctl explain "$@")
    ;;
  operator)
    shift
    (cd services/runner && go run ./cmd/reachctl operator "$@")
    ;;
  pack)
    shift
    (cd services/runner && go run ./cmd/reachctl pack "$@")
    ;;
  wizard)
    shift
    (cd services/runner && go run ./cmd/reachctl wizard "$@")
    ;;
  run)
    shift
    (cd services/runner && go run ./cmd/reachctl run "$@")
    ;;
  share)
    shift
    (cd services/runner && go run ./cmd/reachctl share "$@")
    ;;
  delegate)
    shift
    (cd services/runner && go run ./cmd/reachctl delegate "$@")
    ;;
  verify-proof)
    shift
    (cd services/runner && go run ./cmd/reachctl verify-proof "$@")
    ;;
  help|--help|-h)
    echo "Reach - Deterministic Execution Fabric"
    echo ""
    echo "Commands:"
    echo "  doctor           - System health check"
    echo "  wizard           - Guided run wizard (mobile-friendly)"
    echo "  run <pack>       - Quick run a pack"
    echo "  share            - Share runs via QR/text"
    echo "  operator         - View operator dashboard"
    echo "  capsule          - Create/verify capsules"
    echo "  proof            - Verify execution proofs"
    echo "  packs            - Search/install packs"
    echo ""
    echo "For mobile/Termux: Install with scripts/install-termux.sh"
    ;;
  *)
    echo "usage: reach doctor|release-check|serve|federation|support|arcade|capsule|proof|graph|packs|init|explain|operator|pack|wizard|run|share|delegate|verify-proof" >&2
    echo "       reach help for more info" >&2
    exit 1
    ;;

esac
